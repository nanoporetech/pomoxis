

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Read Until Simulator &mdash; Pomoxis 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Pomoxis 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="pomoxis package" href="pomoxis.html"/>
        <link rel="prev" title="Pomoxis Examples" href="examples.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Pomoxis
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="examples.html">Pomoxis Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Read Until Simulator</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pomoxis.html">pomoxis package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Pomoxis</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Read Until Simulator</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/read_until.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="read-until-simulator">
<h1>Read Until Simulator<a class="headerlink" href="#read-until-simulator" title="Permalink to this headline">¶</a></h1>
<p>The Fast5 playback in pomoxis can act as a read until simulator. There is a
minimal API to fetch raw or event data from current reads and to unblock
channels.</p>
<p>Internally the playback classes construct an index across reads in a channel.
When any request is made, the current simulation sample is calculated from
the current (real) time and an accumulated offset. The simulation sample is used
to calculate the current read and associated raw and event data. When unblock
requests are made the simulation records the difference between the current
simulated sample and the start sample of the following read. This sample offset
is accumulated as subsequent unblock requests are made.</p>
<p>To create an RPC server for an input .fast5 file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pomoxis.provider</span> <span class="kn">import</span> <span class="n">replayfast5</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">replayfast5</span><span class="o">.</span><span class="n">replay_server</span><span class="p">(</span>
    <span class="n">fast5</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">good_class</span><span class="p">,</span> <span class="n">time_warp</span><span class="o">=</span><span class="n">time_warp</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The first three arguments should be self explanatory. <cite>good_class</cite> will set the
read classification of reads which are determined to be valid, usually this
should be set to <cite>‘strand’</cite>. If a request to the server for data is made when
the current read is not of this class, the server will return <cite>None</cite>. The
optional <cite>time_warp</cite> parameter specifies a multiplier for the progression of
time, the default is <cite>1</cite>, but may be set to values larger than this (smaller
and things might break).</p>
<p>To create a client of the above server:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pomoxis.provider</span> <span class="kn">import</span> <span class="n">replayfast5</span>

<span class="n">client</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">replayfast5</span><span class="o">.</span><span class="n">replay_client</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
</pre></div>
</div>
<p>On its own this is pretty useless, but one can quickly build a read until app</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@asyncio.coroutine</span>
<span class="k">def</span> <span class="nf">read_until</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">replayfast5</span><span class="o">.</span><span class="n">replay_client</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
        <span class="n">events</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">read_block</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Channel not in &#39;{}&#39; classification&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">good_class</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">unblock</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">events</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">events</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
<span class="n">event_loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">read_until</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
</pre></div>
</div>
<p>Here, the unblock call passes backsome meta data on the events. This is merely
for programming convenience, the API may be simplified in the future.</p>
<p>A more fullsome example of an concurrent alignment system is given in
<a href="#id1"><span class="problematic" id="id2">:module:`pomoxis.apps`read_until_filter`</span></a>.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pomoxis.html" class="btn btn-neutral float-right" title="pomoxis package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="examples.html" class="btn btn-neutral" title="Pomoxis Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Oxford Nanopore Technologies.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>